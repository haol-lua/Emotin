<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë£¨ì•„ì˜ ê°ì •í…ŒìŠ¤íŠ¸ & ëª…ì–¸ğŸ’™</title>
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      /* justify-content: center; */ /* ë‚´ìš© ìƒë‹¨ ì •ë ¬ */
      padding-top: 40px;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      font-family: 'Gowun Batang', serif;
      background-color: #fff0e0;
      color: #333;
      box-sizing: border-box;
      padding-bottom: 100px;
      overflow-y: auto;
    }

    /* í˜ì´ë“œ ìš”ì†Œ ê³µí†µ ìŠ¤íƒ€ì¼ */
    .fade-element {
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      text-align: center;
      margin-bottom: 20px;
      width: 100%;
      max-width: 600px;
    }

    .fade-element.visible {
      opacity: 1;
    }

    h1 {
      font-size: 1.8em;
      color: #5a3e36;
      margin-bottom: 20px;
      font-weight: bold;
    }

    p {
        font-size: 1.1em;
        line-height: 1.6;
    }

    /* === ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ === */
    button {
      margin: 5px 8px;
      padding: 12px 25px;
      font-size: 1em;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background-color: #ff914d; /* ê¸°ë³¸ ë²„íŠ¼ ìƒ‰ìƒ (ì£¼í™©ìƒ‰ ê³„ì—´) */
      color: white;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      transition: background-color 0.3s ease, transform 0.1s ease;
      font-family: 'Gowun Batang', serif;
    }

    button:hover {
      background-color: #e67e22; /* ê¸°ë³¸ ë²„íŠ¼ í˜¸ë²„ ìƒ‰ìƒ */
    }

    button:active {
        transform: scale(0.98);
    }

    /* === í•˜ë‹¨ ê³ ì • ë²„íŠ¼ ì»¨í…Œì´ë„ˆ ê³µí†µ ìŠ¤íƒ€ì¼ === */
    /* ì´ˆê¸° í™”ë©´ ì œì™¸ ëª¨ë“  í•˜ë‹¨ ê³ ì • ë²„íŠ¼ ì»¨í…Œì´ë„ˆ */
    #start-button,
    #emotion-choice .buttons,
    #answer-buttons,
    .pagination-buttons,
    #quote-page .buttons {
      text-align: center;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      width: 100%;
      position: fixed;
      bottom: 0;
      left: 0;
      background-color: #fff0e0;
      padding: 15px 20px;
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
      box-sizing: border-box;
      z-index: 1000;
      display: flex; /* ê¸°ë³¸ display flex ë¡œ ë³€ê²½ */
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      display: none; /* JSë¡œ ì œì–´ */
    }

    /* Visible ìƒíƒœì¼ ë•Œ */
    #start-button.visible,
    #emotion-choice .buttons.visible,
    #answer-buttons.visible,
    .pagination-buttons.visible,
    #quote-page .buttons.visible {
        opacity: 1;
        display: flex; /* Flex í™œì„±í™” */
    }


    /* === ì´ˆê¸° í™”ë©´ ìŠ¤íƒ€ì¼ === */
    #initial-page {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        min-height: calc(100vh - 100px);
        box-sizing: border-box;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
        display: none; /* JS ì œì–´ */
    }

    #initial-page.visible {
        opacity: 1;
        display: flex;
    }

    #initial-page h1 {
        margin-bottom: 10px;
    }

    /* ì´ˆê¸° í™”ë©´ ë²„íŠ¼ ì»¨í…Œì´ë„ˆ (ê³ ì • ì•„ë‹˜) */
    #initial-page .buttons {
        position: static;
        box-shadow: none;
        background-color: transparent;
        padding: 0;
        margin-top: 20px;
        opacity: 0;
        transition: opacity 0.5s ease-in-out 0.5s;
        display: none; /* JS ì œì–´ */
        text-align: center; /* ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬ */
        width: 100%; /* ë„ˆë¹„ í™•ë³´ */
    }

    #initial-page .buttons.visible {
        opacity: 1;
        display: block; /* blockìœ¼ë¡œ ë³€ê²½í•˜ì—¬ text-align ì ìš© */
    }
    /* ì´ˆê¸° í™”ë©´ ë²„íŠ¼ ìƒ‰ìƒ */
    #initial-page .buttons button {
        background-color: #6a5acd; /* ë³´ë¼ìƒ‰ ê³„ì—´ */
    }
    #initial-page .buttons button:hover {
        background-color: #5a4ac0;
    }


    /* === ê°ì • í…ŒìŠ¤íŠ¸ ì˜ì—­ ìŠ¤íƒ€ì¼ === */
    #emotion-test-area {
        display: none; /* JS ì œì–´ */
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 600px;
        min-height: calc(100vh - 100px);
        box-sizing: border-box;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
    }

    #emotion-test-area.visible {
         opacity: 1;
         display: flex;
    }

    /* ê°ì • í…ŒìŠ¤íŠ¸ ì˜ì—­ ë‚´ í˜ì´ë“œ ìš”ì†Œ */
    #emotion-test-area > .fade-element {
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
    }

     #emotion-test-area > .fade-element.visible {
         opacity: 1;
     }

    /* ê°ì • ì„ íƒ ì œëª© */
    #emotion-test-area #emotion-choice h1 {
        margin-bottom: 10px;
    }

    /* ê°ì • ì„ íƒ ë²„íŠ¼ */
    #emotion-test-area #emotion-choice .buttons button {
        background-color: #ffc107; /* ë…¸ë€ìƒ‰ ê³„ì—´ */
        color: #333;
    }
    #emotion-test-area #emotion-choice .buttons button:hover {
        background-color: #ffb300;
    }

    /* ì§ˆë¬¸(h1) ìŠ¤íƒ€ì¼ */
    #question {
        min-height: 5em;
        display: flex;
        align-items: center;
        justify-content: center;
    }


    /* === ê²°ê³¼ í˜ì´ì§€ ìŠ¤íƒ€ì¼ === */
    #emotion-test-area #result {
      font-size: 1.2em;
      color: #333;
      margin-top: 20px;
      text-align: left;
      width: 100%;
      max-width: 600px;
      line-height: 1.7;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      margin-bottom: 100px;
      display: none; /* ì´ˆê¸° ìˆ¨ê¹€ */
    }

    #emotion-test-area #result.visible {
        opacity: 1;
        display: block;
    }

    /* ê²°ê³¼ í…ìŠ¤íŠ¸ í‘œì‹œ ì˜ì—­ */
    #emotion-test-area #result .result-text-area {
        min-height: 150px;
        padding: 0; /* *** FIX: íŒ¨ë”© ì œê±° (ë°•ìŠ¤ ì œê±°) *** */
        /* *** FIX: ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì œê±° *** */
        /* border: 1px solid #e0d0c0; */
        /* border-radius: 8px; */
        /* background-color: #fff8f0; */
        /* box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); */
        transition: opacity 1.5s ease-in-out;
        opacity: 0; /* JSì—ì„œ fade-in ì œì–´ */
    }

     #emotion-test-area #result .result-text-area p {
         margin-bottom: 12px;
         font-weight: 400;
     }

     #emotion-test-area #result .result-text-area strong {
         display: block;
         margin-bottom: 8px;
         color: #7a5b50;
         font-weight: 700;
         font-size: 1.1em;
     }

     #emotion-test-area #result .result-text-area hr {
         margin: 25px 0;
         border: 0;
         border-top: 1px dashed #d4bfa4;
     }

    /* ê²°ê³¼ í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ */
    /* *** FIX: ë²„íŠ¼ ìƒ‰ìƒ í†µì¼ *** */
    .pagination-buttons button {
        background-color: #ff914d; /* ê¸°ë³¸ ë²„íŠ¼ ìƒ‰ìƒ */
    }
    .pagination-buttons button:hover {
        background-color: #e67e22; /* ê¸°ë³¸ ë²„íŠ¼ í˜¸ë²„ ìƒ‰ìƒ */
    }
    /* ì¬ì‹œì‘ ë²„íŠ¼ë§Œ ë‹¤ë¥¸ ìƒ‰ ìœ ì§€ ì‹œ ì£¼ì„ í•´ì œ */
    /* .pagination-buttons button#restart-button {
        background-color: #f44336;
    }
     .pagination-buttons button#restart-button:hover {
        background-color: #da190b;
    } */


    /* === ëª…ì–¸ í˜ì´ì§€ ìŠ¤íƒ€ì¼ === */
    #quote-page {
        display: none; /* JS ì œì–´ */
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 600px;
         min-height: calc(100vh - 100px);
        box-sizing: border-box;
        text-align: center;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
    }

    #quote-page.visible {
        opacity: 1;
        display: flex;
    }

    #quote-page h1 {
        margin-bottom: 30px;
    }

    /* ëª…ì–¸ í‘œì‹œ ì˜ì—­ */
    #quote-display {
        font-size: 1.4em;
        line-height: 1.8;
        min-height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        width: 100%;
        box-sizing: border-box;
        overflow: hidden;
        position: relative;
        opacity: 1;
        transition: opacity 0.1s ease-in-out;
    }

    /* ëª…ì–¸ í˜ì´ì§€ ë²„íŠ¼ */
    #quote-page .buttons #get-quote-button {
         background-color: #6a5acd; /* ëª…ì–¸ ë³´ê¸° ë²„íŠ¼ ìƒ‰ìƒ */
         margin: 8px;
    }
     #quote-page .buttons #get-quote-button:hover {
        background-color: #5a4ac0;
     }
    #quote-page .buttons button:last-child { /* ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ */
         background-color: #777; /* íšŒìƒ‰ ê³„ì—´ */
    }
     #quote-page .buttons button:last-child:hover {
         background-color: #666;
    }

  </style>
</head>
<body>

    <div id="initial-page">
        <h1 class="fade-element">ë£¨ì•„ì˜ ê°ì • & ëª…ì–¸</h1>
        <p class="fade-element">ë‹¹ì‹ ì˜ ë§ˆìŒì„ ë“¤ì—¬ë‹¤ë³´ê±°ë‚˜<br>ì˜¤ëŠ˜ì˜ í˜ì´ ë˜ëŠ” ëª…ì–¸ì„ ë§Œë‚˜ë³´ì„¸ìš”.</p>
        <div class="buttons" id="initial-buttons">
            <button onclick="showEmotionTestStart()">ê°ì • í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
            <button onclick="showQuotePage()">ì˜¤ëŠ˜ì˜ ëª…ì–¸ ë³´ê¸°</button>
        </div>
    </div>

    <div id="emotion-test-area">
        <h1 id="title" class="fade-element">ë£¨ì•„ì˜ ê°ì •í…ŒìŠ¤íŠ¸ğŸ’™</h1>
        <p id="description" class="fade-element">ë‹¹ì‹ ì˜ ê°ì • íë¦„ì„ ì•Œì•„ë³´ëŠ” ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤.<br>ê° ì§ˆë¬¸ì— ì†”ì§í•˜ê²Œ ë‹µí•´ ì£¼ì„¸ìš”.</p>
        <div class="buttons" id="start-button">
            <button onclick="chooseEmotion()">OK</button>
        </div>

        <div id="emotion-choice" class="fade-element">
            <h1>ë‹¹ì‹ ì´ ê¶ê¸ˆí•œ ê°ì •ì€ ë¬´ì—‡ì¸ê°€ìš”?</h1>
            <div class="buttons">
                <button onclick="selectEmotion('ì‚¬ë‘')">ğŸ’– ì‚¬ë‘</button>
                <button onclick="selectEmotion('ìŠ¬í””')">ğŸŒ§ï¸ ìŠ¬í””</button>
                <button onclick="selectEmotion('ê¸°ì¨')">ğŸŒ ê¸°ì¨</button>
                <button onclick="selectEmotion('ë‘ë ¤ì›€')">ğŸ›¡ï¸ ë‘ë ¤ì›€</button>
                <button onclick="selectEmotion('ìš©ê¸°')">ğŸ¦‹ ìš©ê¸°</button>
            </div>
        </div>

        <h1 id="question" class="fade-element"></h1>
        <div class="buttons" id="answer-buttons">
            <button onclick="handleAnswer('yes')">Yes</button>
            <button onclick="handleAnswer('no')">No</button>
        </div>

        <div id="result" class="fade-element">
            <div class="result-text-area"></div> </div>

        <div class="pagination-buttons" id="result-buttons">
            <button id="prev-button" onclick="navigateResult(-1)">ì´ì „</button>
            <button id="next-button" onclick="navigateResult(1)">ë‹¤ìŒ</button>
            <button id="restart-button" onclick="restartTest()">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>

    <div id="quote-page">
        <h1>ì˜¤ëŠ˜ì˜ ëª…ì–¸</h1>
        <div id="quote-display">
            <p>ë²„íŠ¼ì„ ëˆŒëŸ¬ ì˜¤ëŠ˜ì˜ ëª…ì–¸ì„ í™•ì¸í•˜ì„¸ìš”!</p>
        </div>
        <div class="buttons">
             <button id="get-quote-button">ìƒˆë¡œìš´ ëª…ì–¸ ë³´ê¸°</button>
             <button onclick="showInitialPage()">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
        </div>
    </div>


  <script src="quotes.js"></script>
  <script src="results_data.js"></script>

  <script>
    // --- DOM Element References ---
    const initialPageEl = document.getElementById('initial-page');
    const initialButtonsEl = document.getElementById('initial-buttons');

    const emotionTestAreaEl = document.getElementById('emotion-test-area');
    const titleEl = document.getElementById('title');
    const descriptionEl = document.getElementById('description');
    const startButtonEl = document.getElementById('start-button');
    const emotionChoiceEl = document.getElementById('emotion-choice');
    const emotionButtonsEl = emotionChoiceEl.querySelector('.buttons');
    const questionEl = document.getElementById('question');
    const answerButtonsEl = document.getElementById('answer-buttons');
    const resultEl = document.getElementById('result');
    const resultTextAreaEl = resultEl.querySelector('.result-text-area');
    const resultButtonsEl = document.getElementById('result-buttons');
    const prevButtonEl = document.getElementById('prev-button');
    const nextButtonEl = document.getElementById('next-button');
    const restartButtonEl = document.getElementById('restart-button');

    const quotePageEl = document.getElementById('quote-page');
    const quoteDisplayEl = document.getElementById('quote-display');
    const getQuoteButtonEl = document.getElementById('get-quote-button');
    const quotePageButtonsEl = quotePageEl.querySelector('.buttons');


    // --- Question Data Structure ---
    // ê° ê°ì •ë³„ ì§ˆë¬¸ íŠ¸ë¦¬ êµ¬ì¡°
    const questionTree = {
        'ì‚¬ë‘': {
            question: "ìµœê·¼ ê°€ìŠ´ ë›°ëŠ” ì„¤ë ˜ì„ ëŠë‚€ ì ì´ ìˆë‚˜ìš”?",
            yes: {
                question: "ê·¸ ê°ì •ì„ ë‹¤ë¥¸ ì‚¬ëŒê³¼ ë‚˜ëˆ„ê³  ì‹¶ë‹¤ëŠ” ìƒê°ì´ ë“œë‚˜ìš”?",
                yes: {
                    question: "ì‚¬ë‘ ë•Œë¬¸ì— ì  ëª» ì´ë£¬ ë°¤ì´ ìˆë‚˜ìš”?",
                    yes: null, // Result path: yes-yes-yes
                    no: null   // Result path: yes-yes-no
                },
                no: {
                    question: "ì§€ë‚˜ê°„ ì‚¬ë‘ì— ëŒ€í•œ ì•„ì‰¬ì›€ì´ ë‚¨ì•„ ìˆë‚˜ìš”?",
                    yes: null, // Result path: yes-no-yes
                    no: null   // Result path: yes-no-no
                }
            },
            no: {
                question: "ìƒˆë¡œìš´ ë§Œë‚¨ì— ëŒ€í•œ ê¸°ëŒ€ê°ì´ ìˆë‚˜ìš”?",
                yes: {
                    question: "ëˆ„êµ°ê°€ì—ê²Œ ë¨¼ì € ë‹¤ê°€ê°€ëŠ” ê²ƒì´ ì–´ë µì§€ ì•Šë‚˜ìš”?",
                    yes: null, // Result path: no-yes-yes
                    no: null   // Result path: no-yes-no
                },
                no: {
                    question: "í˜¼ì ìˆëŠ” ì‹œê°„ì´ ë” í¸ì•ˆí•˜ê²Œ ëŠê»´ì§€ë‚˜ìš”?",
                    yes: null, // Result path: no-no-yes
                    no: null   // Result path: no-no-no
                }
            }
        },
        'ìŠ¬í””': {
            question: "ìµœê·¼ ë§ˆìŒê» ìš¸ì–´ë³¸ ì ì´ ìˆë‚˜ìš”?",
            yes: {
                question: "ìŠ¬í””ì„ ëˆ„êµ°ê°€ì—ê²Œ í„¸ì–´ë†“ê³  ìœ„ë¡œë°›ê³  ì‹¶ë‚˜ìš”?",
                yes: {
                    question: "ë‚˜ì˜ ìŠ¬í””ì„ ì´í•´í•´ì£¼ëŠ” ì‚¬ëŒì´ ìˆë‹¤ê³  ëŠë¼ë‚˜ìš”?",
                    yes: null, // Result path: yes-yes-yes
                    no: null   // Result path: yes-yes-no
                },
                no: {
                    question: "í˜¼ìì„œ ìŠ¬í””ì„ ì‚­ì´ëŠ” í¸ì¸ê°€ìš”?",
                    yes: null, // Result path: yes-no-yes
                    no: null   // Result path: yes-no-no
                }
            },
            no: {
                question: "ê°€ìŠ´ì´ ë‹µë‹µí•˜ê±°ë‚˜ ë¨¹ë¨¹í•¨ì„ ìì£¼ ëŠë¼ë‚˜ìš”?",
                yes: {
                    question: "ìŠ¬í””ì„ ì• ì¨ ì™¸ë©´í•˜ë ¤ í•œ ì ì´ ìˆë‚˜ìš”?",
                    yes: null, // Result path: no-yes-yes
                    no: null   // Result path: no-yes-no
                },
                no: {
                    question: "íŠ¹ë³„íˆ ìŠ¬í”„ë‹¤ê³  ëŠë¼ì§€ ì•Šë‚˜ìš”?",
                    yes: null, // Result path: no-no-yes
                    no: null   // Result path: no-no-no
                }
            }
        },
        'ê¸°ì¨': {
            question: "ìµœê·¼ ì†Œë¦¬ ë‚´ì–´ ì›ƒì—ˆë˜ ê¸°ì–µì´ ìˆë‚˜ìš”?",
            yes: {
                question: "ê·¸ ê¸°ì¨ì„ ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ë‚˜ëˆ„ì—ˆë‚˜ìš”?",
                yes: {
                    question: "ì‚¬ì†Œí•œ ê²ƒì—ì„œë„ ì¦ê±°ì›€ì„ ì°¾ëŠ” í¸ì¸ê°€ìš”?",
                    yes: null, // Result path: yes-yes-yes
                    no: null   // Result path: yes-yes-no
                },
                no: {
                    question: "ê¸°ì¨ì˜ ìˆœê°„ì´ ì§§ê²Œ ëŠê»´ì¡Œë‚˜ìš”?",
                    yes: null, // Result path: yes-no-yes
                    no: null   // Result path: yes-no-no
                }
            },
            no: {
                question: "ìŠ¤ìŠ¤ë¡œë¥¼ ìœ„í•´ ì‘ì€ ì„ ë¬¼ì„ í•œ ì ì´ ìˆë‚˜ìš”?",
                yes: {
                    question: "ë‚˜ë¥¼ ê¸°ì˜ê²Œ í•˜ëŠ” ê²ƒì´ ë¬´ì—‡ì¸ì§€ ì•Œê³  ìˆë‚˜ìš”?",
                    yes: null, // Result path: no-yes-yes
                    no: null   // Result path: no-yes-no
                },
                no: {
                    question: "ìš”ì¦˜ ì¼ìƒì—ì„œ ì¦ê±°ì›€ì„ ëŠë¼ê¸° ì–´ë µë‚˜ìš”?",
                    yes: null, // Result path: no-no-yes
                    no: null   // Result path: no-no-no
                }
            }
        },
        'ë‘ë ¤ì›€': {
            question: "ìµœê·¼ ë¬´ì–¸ê°€ì— ëŒ€í•´ ê±±ì •í•˜ê±°ë‚˜ ë¶ˆì•ˆí–ˆë˜ ì ì´ ìˆë‚˜ìš”?",
            yes: {
                question: "ê·¸ ë‘ë ¤ì›€ ë•Œë¬¸ì— í•˜ê³  ì‹¶ì€ ì¼ì„ ë§ì„¤ì˜€ë‚˜ìš”?",
                yes: {
                    question: "ë‘ë ¤ì›€ì„ ê·¹ë³µí•˜ê¸° ìœ„í•´ ë…¸ë ¥í•´ ë³¸ ì ì´ ìˆë‚˜ìš”?",
                    yes: null, // Result path: yes-yes-yes
                    no: null   // Result path: yes-yes-no
                },
                no: {
                    question: "ë‘ë ¤ì›€ë³´ë‹¤ëŠ” ì‹ ì¤‘í•¨ì´ë¼ê³  ìƒê°í•˜ë‚˜ìš”?",
                    yes: null, // Result path: yes-no-yes
                    no: null   // Result path: yes-no-no
                }
            },
            no: {
                question: "ìƒˆë¡œìš´ ë„ì „ ì•ì—ì„œ ê¸´ì¥ê°ì„ ëŠë¼ëŠ” í¸ì¸ê°€ìš”?",
                yes: {
                    question: "ê¸´ì¥ê°ì„ ì„¤ë ˜ìœ¼ë¡œ ë°”ê¿€ ìˆ˜ ìˆë‹¤ê³  ìƒê°í•˜ë‚˜ìš”?",
                    yes: null, // Result path: no-yes-yes
                    no: null   // Result path: no-yes-no
                },
                no: {
                    question: "ëŒ€ì²´ë¡œ ë§ˆìŒì´ í‰ì˜¨í•œ ìƒíƒœì¸ê°€ìš”?",
                    yes: null, // Result path: no-no-yes
                    no: null   // Result path: no-no-no
                }
            }
        },
        'ìš©ê¸°': {
            question: "ìµœê·¼ ì–´ë ¤ìš´ ìƒí™©ì— ë§ì„œì•¼ í–ˆë˜ ê²½í—˜ì´ ìˆë‚˜ìš”?",
            yes: {
                question: "ê·¸ ê²½í—˜ì„ í†µí•´ ìŠ¤ìŠ¤ë¡œ ì„±ì¥í–ˆë‹¤ê³  ëŠë¼ë‚˜ìš”?",
                yes: {
                    question: "ë‹¤ì‹œ ë¹„ìŠ·í•œ ìƒí™©ì´ ì™€ë„ ë§ì„¤ ìì‹ ì´ ìˆë‚˜ìš”?",
                    yes: null, // Result path: yes-yes-yes
                    no: null   // Result path: yes-yes-no
                },
                no: {
                    question: "ìƒì²˜ë‚˜ í›„íšŒê°€ ë‚¨ì•˜ë‚˜ìš”?",
                    yes: null, // Result path: yes-no-yes
                    no: null   // Result path: yes-no-no
                }
            },
            no: {
                question: "ìš©ê¸°ë¥¼ ë‚´ì•¼ í•˜ëŠ” ìƒí™©ì„ í”¼í•˜ê³  ì‹¶ì—ˆë˜ ì ì´ ìˆë‚˜ìš”?",
                yes: {
                    question: "í”¼í–ˆë˜ ì„ íƒì— ëŒ€í•´ í›„íšŒí•œ ì ì´ ìˆë‚˜ìš”?",
                    yes: null, // Result path: no-yes-yes
                    no: null   // Result path: no-yes-no
                },
                no: {
                    question: "ìš©ê¸°ë¥¼ ë‚´ëŠ” ê²ƒë³´ë‹¤ ì•ˆì „í•œ ì„ íƒì„ ì„ í˜¸í•˜ë‚˜ìš”?",
                    yes: null, // Result path: no-no-yes
                    no: null   // Result path: no-no-no
                }
            }
        }
    };

    // --- ëª…ì–¸ ë°ì´í„° (quotes.js íŒŒì¼ì—ì„œ ë¡œë“œë©ë‹ˆë‹¤) ---
    // quotes ë³€ìˆ˜ëŠ” quotes.js ì—ì„œ ë¡œë“œë¨

    // --- ê²°ê³¼ í…ìŠ¤íŠ¸ ë°ì´í„° (results_data.js íŒŒì¼ì—ì„œ ë¡œë“œë©ë‹ˆë‹¤) ---
    // resultTexts ë³€ìˆ˜ëŠ” results_data.js ì—ì„œ ë¡œë“œë¨


    // --- State Variables ---
    let selectedEmotionKey = null; // ì„ íƒëœ ê°ì • í‚¤ ('ì‚¬ë‘', 'ìŠ¬í””' ë“±)
    let currentNode = null; // í˜„ì¬ ì§ˆë¬¸ ë…¸ë“œ
    let answers = []; // ì‚¬ìš©ìì˜ ë‹µë³€ ê¸°ë¡ (['yes', 'no', 'yes'])
    let currentResultSections = []; // í˜„ì¬ í‘œì‹œí•  ê²°ê³¼ í…ìŠ¤íŠ¸ ì„¹ì…˜ ë°°ì—´
    let currentSectionIndex = 0; // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ ê²°ê³¼ ì„¹ì…˜ ì¸ë±ìŠ¤
    let slotAnimationInterval = null; // ëª…ì–¸ ìŠ¬ë¡¯ ì• ë‹ˆë©”ì´ì…˜ ì¸í„°ë²Œ ID


    // --- Utility Functions ---

    /**
     * ì§€ì •ëœ ìš”ì†Œë¥¼ ë¶€ë“œëŸ½ê²Œ ìˆ¨ê¹ë‹ˆë‹¤. (fade out í›„ display: none)
     * @param {HTMLElement} element - ìˆ¨ê¸¸ ìš”ì†Œ
     */
    function hideElementSmoothly(element) {
        if (!element) return;
        element.classList.remove('visible');
        setTimeout(() => {
            element.style.display = 'none';
        }, 500); // CSS transition ì‹œê°„ê³¼ ì¼ì¹˜
    }

    /**
     * ì§€ì •ëœ ìš”ì†Œë¥¼ ë¶€ë“œëŸ½ê²Œ í‘œì‹œí•©ë‹ˆë‹¤. (display ì„¤ì • í›„ fade in)
     * @param {HTMLElement} element - í‘œì‹œí•  ìš”ì†Œ
     * @param {string} [displayType='flex'] - CSS display ì†ì„± ê°’
     */
    function showElementSmoothly(element, displayType = 'flex') {
        if (!element) return;
        element.style.opacity = 0; // ì‹œì‘ ì‹œ íˆ¬ëª…
        element.classList.remove('visible'); // visible í´ë˜ìŠ¤ ì œê±° (ì´ˆê¸°í™”)
        element.style.display = displayType; // display ì†ì„± ì„¤ì •

        // ì ì‹œ í›„ visible í´ë˜ìŠ¤ ì¶”ê°€í•˜ì—¬ fade-in ì‹œì‘
        setTimeout(() => {
            element.classList.add('visible');
            element.style.opacity = 1; // opacity 1ë¡œ ë³€ê²½í•˜ì—¬ transition íŠ¸ë¦¬ê±°
        }, 50); // ì§§ì€ ì§€ì—°
    }

    /**
     * ê²°ê³¼ í…ìŠ¤íŠ¸ë¥¼ ë¶€ë“œëŸ½ê²Œ í‘œì‹œí•©ë‹ˆë‹¤. (fade out -> ë‚´ìš© ë³€ê²½ -> fade in)
     * @param {HTMLElement} element - í…ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•  ìš”ì†Œ (resultTextAreaEl)
     * @param {string} htmlString - í‘œì‹œí•  HTML ë¬¸ìì—´
     * @param {Function} [onComplete] - ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ í›„ ì‹¤í–‰í•  ì½œë°± í•¨ìˆ˜
     */
    function displayResultTextSmoothly(element, htmlString, onComplete) {
        if (!element) return;
        const fadeOutDuration = 300; // Fade out ì‹œê°„
        const fadeInDuration = 1000; // Fade in ì‹œê°„ (CSS transitionê³¼ ì¼ì¹˜ ë˜ëŠ” ì¡°ì •)

        element.style.transition = `opacity ${fadeOutDuration}ms ease-in-out`; // Fade out transition ì„¤ì •
        element.style.opacity = 0; // Fade out ì‹œì‘

        setTimeout(() => {
            element.innerHTML = htmlString; // ë‚´ìš© ë³€ê²½
            element.style.transition = `opacity ${fadeInDuration}ms ease-in-out`; // Fade in transition ì„¤ì •
            // ì ì‹œ í›„ fade in ì‹œì‘
            setTimeout(() => {
                element.style.opacity = 1;
                // Fade in ì™„ë£Œ í›„ ì½œë°± ì‹¤í–‰
                setTimeout(() => {
                    if (onComplete) onComplete();
                    // *** FIX: ì›ë˜ transition ë³µì› ì‹œì  ë³€ê²½ ***
                    // ì½œë°± ì‹¤í–‰ í›„ ë³µì›í•´ì•¼ ì½œë°± ë‚´ì—ì„œ ì¶”ê°€ ì¡°ì‘ ì‹œ ë¬¸ì œ ì—†ìŒ
                    element.style.transition = 'opacity 1.5s ease-in-out';
                }, fadeInDuration);
            }, 50);
        }, fadeOutDuration);
    }

    /**
     * ê²°ê³¼ ì„¹ì…˜ HTMLì—ì„œ ì•ë¶€ë¶„ì˜ "ìˆ«ì." ë¥¼ ì œê±°í•©ë‹ˆë‹¤.
     * @param {string} sectionHTML - ì²˜ë¦¬í•  HTML ì„¹ì…˜ ë¬¸ìì—´
     * @returns {string} ì²˜ë¦¬ëœ HTML ë¬¸ìì—´
     */
    function processResultSectionHTML(sectionHTML) {
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = sectionHTML.trim();
        let targetNode = null;
        if (tempDiv.firstChild) {
            if (tempDiv.firstChild.nodeType === Node.TEXT_NODE) {
                targetNode = tempDiv.firstChild;
            } else if (tempDiv.firstChild.nodeType === Node.ELEMENT_NODE) {
                const firstElement = tempDiv.firstChild;
                if (firstElement.firstChild && firstElement.firstChild.nodeType === Node.TEXT_NODE) {
                    targetNode = firstElement.firstChild;
                } else if (firstElement.tagName === 'STRONG' && firstElement.firstChild && firstElement.firstChild.nodeType === Node.TEXT_NODE) {
                     targetNode = firstElement.firstChild;
                } else {
                    const textNodes = [];
                    function findTextNodes(node) {
                        if (node.nodeType === Node.TEXT_NODE && node.textContent.trim().length > 0) {
                            textNodes.push(node);
                        }
                        if (node.childNodes) { // childNodesê°€ ìˆëŠ”ì§€ í™•ì¸
                            for (let i = 0; i < node.childNodes.length; i++) {
                                findTextNodes(node.childNodes[i]);
                            }
                        }
                    }
                    findTextNodes(firstElement);
                    if (textNodes.length > 0) {
                        targetNode = textNodes[0];
                    }
                }
            }
        }
        if (targetNode && targetNode.nodeType === Node.TEXT_NODE) {
            let textContent = targetNode.textContent;
            const numberPrefixRegex = /^\s*\d+\.\s*/;
            if (numberPrefixRegex.test(textContent)) {
                targetNode.textContent = textContent.replace(numberPrefixRegex, '');
            }
        }
        return tempDiv.innerHTML;
    }

    // --- ëª…ì–¸ ê´€ë ¨ í•¨ìˆ˜ ---
    /**
     * quotes ë°°ì—´ì—ì„œ ë¬´ì‘ìœ„ ëª…ì–¸ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
     * @returns {string} ë¬´ì‘ìœ„ ëª…ì–¸ ë˜ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€
     */
    function getRandomQuote() {
        if (typeof quotes === 'undefined' || !Array.isArray(quotes) || quotes.length === 0) {
             console.error("ëª…ì–¸ ë°ì´í„°(quotes.js)ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ê±°ë‚˜ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
             return "ëª…ì–¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
        }
        const randomIndex = Math.floor(Math.random() * quotes.length);
        return quotes[randomIndex];
    }

    /**
     * ëª…ì–¸ ìŠ¬ë¡¯ë¨¸ì‹  ì• ë‹ˆë©”ì´ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.
     */
    function startSlotAnimation() {
        if (!quoteDisplayEl || !getQuoteButtonEl) return;

        const animationDuration = 2000;
        const frameRate = 60;
        const totalFrames = animationDuration / frameRate;
        let currentFrame = 0;

        getQuoteButtonEl.disabled = true;

        if (slotAnimationInterval) clearInterval(slotAnimationInterval);

        slotAnimationInterval = setInterval(() => {
            quoteDisplayEl.style.transition = 'opacity 0.05s ease-in-out';
            quoteDisplayEl.style.opacity = 0;
            setTimeout(() => {
                 quoteDisplayEl.innerHTML = `<p>${getRandomQuote()}</p>`;
                 quoteDisplayEl.style.opacity = 1;
            }, 50);

            currentFrame++;
            if (currentFrame >= totalFrames) {
                clearInterval(slotAnimationInterval);
                slotAnimationInterval = null;
                displayFinalQuote();
            }
        }, frameRate);
    }

    /**
     * ì• ë‹ˆë©”ì´ì…˜ í›„ ìµœì¢… ëª…ì–¸ì„ ë¶€ë“œëŸ½ê²Œ í‘œì‹œí•©ë‹ˆë‹¤.
     */
    function displayFinalQuote() {
        if (!quoteDisplayEl || !getQuoteButtonEl) return;
        const finalQuote = getRandomQuote();
        const fadeOutDuration = 100;
        const fadeInDuration = 500;

        quoteDisplayEl.style.transition = `opacity ${fadeOutDuration}ms ease-in-out`;
        quoteDisplayEl.style.opacity = 0;

        setTimeout(() => {
            quoteDisplayEl.innerHTML = `<p>${finalQuote}</p>`;
            quoteDisplayEl.style.transition = `opacity ${fadeInDuration}ms ease-in-out`;
            quoteDisplayEl.style.opacity = 1;
            setTimeout(() => {
                 getQuoteButtonEl.disabled = false;
                 quoteDisplayEl.style.transition = 'opacity 0.1s ease-in-out';
            }, fadeInDuration);
        }, fadeOutDuration);
    }


    // --- í˜ì´ì§€ ì „í™˜ í•¨ìˆ˜ ---

    // ì´ˆê¸° í™”ë©´ í‘œì‹œ
    function showInitialPage() {
        hideElementSmoothly(emotionTestAreaEl);
        hideElementSmoothly(quotePageEl);
        showElementSmoothly(initialPageEl, 'flex');
        setTimeout(() => {
            if (initialPageEl) {
                 initialPageEl.querySelectorAll('.fade-element').forEach(el => el.classList.add('visible'));
                 if (initialButtonsEl) {
                     // *** FIX: ì´ˆê¸° í™”ë©´ ë²„íŠ¼ í‘œì‹œ ë¡œì§ ìˆ˜ì • ***
                     initialButtonsEl.style.opacity = 0; // ì‹œì‘ ì‹œ íˆ¬ëª…
                     initialButtonsEl.classList.remove('visible');
                     initialButtonsEl.style.display = 'block'; // display ì„¤ì •
                     // ì ì‹œ í›„ visible í´ë˜ìŠ¤ ì¶”ê°€í•˜ì—¬ fade-in
                     setTimeout(() => {
                         initialButtonsEl.classList.add('visible');
                         initialButtonsEl.style.opacity = 1;
                     }, 50); // ì§§ì€ ì§€ì—°
                 }
            }
        }, 100);
    }


    // ê°ì • í…ŒìŠ¤íŠ¸ ì‹œì‘ í™”ë©´ í‘œì‹œ
    function showEmotionTestStart() {
        hideElementSmoothly(initialPageEl);
        hideElementSmoothly(quotePageEl);

        // ìƒíƒœ ì´ˆê¸°í™”
        selectedEmotionKey = null;
        currentNode = null;
        answers = [];
        currentResultSections = [];
        currentSectionIndex = 0;
        if (resultTextAreaEl) resultTextAreaEl.innerHTML = '';
        if (resultTextAreaEl) resultTextAreaEl.style.opacity = 0;
        hideElementSmoothly(resultEl);
        hideElementSmoothly(resultButtonsEl);


        showElementSmoothly(emotionTestAreaEl, 'flex');
        setTimeout(() => {
            if (titleEl) showElementSmoothly(titleEl, 'block');
            if (descriptionEl) showElementSmoothly(descriptionEl, 'block');
            if (startButtonEl) showElementSmoothly(startButtonEl, 'flex');
        }, 100);
    }

    // ëª…ì–¸ í˜ì´ì§€ í‘œì‹œ
    function showQuotePage() {
        hideElementSmoothly(initialPageEl);
        hideElementSmoothly(emotionTestAreaEl);

        if (slotAnimationInterval) clearInterval(slotAnimationInterval);
        if (getQuoteButtonEl) getQuoteButtonEl.disabled = false;
        if (quoteDisplayEl) quoteDisplayEl.innerHTML = '<p>ë²„íŠ¼ì„ ëˆŒëŸ¬ ì˜¤ëŠ˜ì˜ ëª…ì–¸ì„ í™•ì¸í•˜ì„¸ìš”!</p>';
        if (quoteDisplayEl) quoteDisplayEl.style.opacity = 1;

        showElementSmoothly(quotePageEl, 'flex');
        setTimeout(() => {
            if (quotePageEl && quotePageEl.querySelector('h1')) {
                 quotePageEl.querySelector('h1').classList.add('visible');
            }
            if (quotePageButtonsEl) showElementSmoothly(quotePageButtonsEl, 'flex');
        }, 100);
    }


    // --- ê°ì • í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ---

    // OK ë²„íŠ¼ í´ë¦­ -> ê°ì • ì„ íƒ í™”ë©´ í‘œì‹œ
    function chooseEmotion() {
        hideElementSmoothly(titleEl);
        hideElementSmoothly(descriptionEl);
        hideElementSmoothly(startButtonEl);

        setTimeout(() => {
            if (emotionChoiceEl) showElementSmoothly(emotionChoiceEl, 'block');
            if (emotionButtonsEl) showElementSmoothly(emotionButtonsEl, 'flex');
        }, 500);
    }

    // ê°ì • ì„ íƒ -> ì²« ì§ˆë¬¸ í‘œì‹œ
    function selectEmotion(emotionKey) {
      if (typeof questionTree === 'undefined' || !questionTree[emotionKey]) {
          console.error(`'${emotionKey}'ì— ëŒ€í•œ ì§ˆë¬¸ íŠ¸ë¦¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
          return;
      }
      selectedEmotionKey = emotionKey;
      currentNode = questionTree[emotionKey];
      answers = [];

      hideElementSmoothly(emotionChoiceEl);
      hideElementSmoothly(emotionButtonsEl);

      setTimeout(() => {
          if (questionEl) showElementSmoothly(questionEl, 'flex');
          if (answerButtonsEl) showElementSmoothly(answerButtonsEl, 'flex');
          displayQuestion();
      }, 500);
    }

    // í˜„ì¬ ì§ˆë¬¸ í‘œì‹œ
    function displayQuestion() {
      if (!questionEl) return;

      if (currentNode && currentNode.question) {
        questionEl.style.opacity = 0;
        setTimeout(() => {
            questionEl.innerText = currentNode.question;
            questionEl.style.opacity = 1;
        }, 300);

        if (answerButtonsEl && !answerButtonsEl.classList.contains('visible')) {
            showElementSmoothly(answerButtonsEl, 'flex');
        }
      } else {
        calculateResult();
      }
    }

    // ë‹µë³€ ì²˜ë¦¬ (Yes/No)
    function handleAnswer(answer) {
      if (!currentNode) return;

      const nextNode = currentNode[answer];

      if (nextNode !== undefined) {
        answers.push(answer);
        currentNode = nextNode;

        if (currentNode && currentNode.question) {
            displayQuestion();
        } else {
            hideElementSmoothly(questionEl);
            hideElementSmoothly(answerButtonsEl);
            setTimeout(() => {
                showElementSmoothly(resultEl, 'block');
                calculateResult();
            }, 500);
        }
      } else {
          console.error("ì •ì˜ë˜ì§€ ì•Šì€ ë‹µë³€ ê²½ë¡œì…ë‹ˆë‹¤:", answer);
      }
    }

    // ìµœì¢… ê²°ê³¼ ê³„ì‚° ë° í‘œì‹œ
    function calculateResult() {
      const path = answers.join('-');
      let fullResultHTML = "<p>ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>";

      if (typeof resultTexts !== 'undefined' && selectedEmotionKey && resultTexts[selectedEmotionKey] && resultTexts[selectedEmotionKey][path]) {
          fullResultHTML = resultTexts[selectedEmotionKey][path];
      } else {
          console.error(`ê²°ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ê°ì •='${selectedEmotionKey}', ê²½ë¡œ='${path}'`);
      }

      const sections = fullResultHTML.split('<hr>').map(section => section.trim()).filter(section => section.length > 0);
      currentResultSections = sections.map(sectionHTML => processResultSectionHTML(sectionHTML));
      currentSectionIndex = 0;

      displayResultTextSmoothly(resultTextAreaEl, currentResultSections[currentSectionIndex] || "<p>ê²°ê³¼ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>", () => {
           showElementSmoothly(resultButtonsEl, 'flex');
           updateResultButtons();
      });
    }

    // íŠ¹ì • ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ
    function displayResultSection(index) {
        if (index >= 0 && index < currentResultSections.length) {
            currentSectionIndex = index;
            displayResultTextSmoothly(resultTextAreaEl, currentResultSections[index], () => {
                updateResultButtons();
            });
        }
    }

    // ê²°ê³¼ í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
    function updateResultButtons() {
        if (!prevButtonEl || !nextButtonEl || !restartButtonEl) return;

        prevButtonEl.style.display = (currentSectionIndex > 0) ? 'inline-block' : 'none';

        if (currentSectionIndex < currentResultSections.length - 1) {
            nextButtonEl.style.display = 'inline-block';
            restartButtonEl.style.display = 'none';
        } else {
            nextButtonEl.style.display = 'none';
            restartButtonEl.style.display = 'inline-block';
        }

        if (currentResultSections.length <= 1) {
             prevButtonEl.style.display = 'none';
             nextButtonEl.style.display = 'none';
             restartButtonEl.style.display = 'inline-block';
        }
    }


    // ê²°ê³¼ í˜ì´ì§€ë„¤ì´ì…˜ ì´ë™
    function navigateResult(direction) {
        const newIndex = currentSectionIndex + direction;
        displayResultSection(newIndex);
    }


    // í…ŒìŠ¤íŠ¸ ë‹¤ì‹œ ì‹œì‘ -> ì´ˆê¸° í™”ë©´ìœ¼ë¡œ
    function restartTest() {
        hideElementSmoothly(resultEl);
        hideElementSmoothly(resultButtonsEl);

        setTimeout(() => {
            hideElementSmoothly(emotionChoiceEl);
            hideElementSmoothly(questionEl);
            hideElementSmoothly(answerButtonsEl);
            showInitialPage();
        }, 500);
    }

    // --- Initial Load ---
    window.onload = () => {
        if (initialPageEl) initialPageEl.style.opacity = 0;
        if (emotionTestAreaEl) emotionTestAreaEl.style.opacity = 0;
        if (quotePageEl) quotePageEl.style.opacity = 0;

        const allButtonContainers = document.querySelectorAll('.buttons, .pagination-buttons');
        allButtonContainers.forEach(container => {
             container.style.opacity = 0;
             container.style.display = 'none';
        });

        showInitialPage();
    };

    // --- Event Listeners ---
    if (getQuoteButtonEl) {
        getQuoteButtonEl.addEventListener('click', startSlotAnimation);
    } else {
        console.warn("ID 'get-quote-button' ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

  </script>
</body>
</html>
